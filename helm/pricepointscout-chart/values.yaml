# Application Configuration
app:
  namespace: pps-namespace
  
  # Application Image
  image:
    repository: omarzakaria10/price-point-scout
    tag: "3410e8c7097be71ad7dfbc998e5047aa9d456f83"
    pullPolicy: IfNotPresent
  
  # Application Port
  containerPort: 8080
  
  # Application Resources
  resources:
    requests:
      cpu: "1.5"
      memory: "1.5Gi"
    limits:
      cpu: "2.5"
      memory: "3Gi"
  
  # Application Service
  service:
    type: ClusterIP
    port: 8080
  
  # JWT Configuration
  jwt:
    expiresIn: "90d"
    cookie:
      expiresIn: "9000"
  
  # Application Secrets (plain text - will be base64 encoded in template)
  secret:
    databasePassword: ""  # MongoDB password (leave empty if no auth)
    jwtSecret: "my-ultra-secure-and-ultra-long-secret"
    emailUsername: "pricepointscout@gmail.com"
    emailPassword: "pricepointscout123"

# Frontend Configuration
frontend:
  # Frontend Image
  image:
    repository: omarzakaria10/price-point-scout-react
    tag: "V1.0.3"
    pullPolicy: IfNotPresent
  
  # Frontend Port
  containerPort: 80
  
  # Frontend Resources
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "200m"
      memory: "256Mi"
  
  # Frontend Service
  service:
    type: ClusterIP
    port: 80
  
  # Number of replicas
  replicas: 2

# MongoDB Configuration
mongodb:
  replicas: 2  # Can be 2, 3, or any number
  storageClassName: "do-block-storage"  # DigitalOcean Block Storage (use "managed-csi" for Azure AKS)
  storage: "1Gi"
  
  resources:
    requests:
      cpu: "150m"
      memory: "256Mi"
    limits:
      cpu: "300m"
      memory: "512Mi"

# Redis Configuration
redis:
  containerPort: 6379
  
  service:
    port: 6379
  
  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "150m"

# HPA Configuration
hpa:
  minReplicas: 1
  maxReplicas: 5
  metrics:
    cpu:
      averageUtilization: 70
    memory:
      averageUtilization: 75
# Ingress Configuration
ingress:
  enabled: true
  className: nginx
  host: "pricepointscout.dev"  # Leave empty for IP-based access, or set your domain (e.g., "pps.example.com")
  
  # TLS Configuration
  tls:
    enabled: true
    secretName: pricepointscout-tls
  
  annotations:
    # Cert-manager annotations for automatic TLS
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    
    # Real IP forwarding (important for rate limiting)
    nginx.ingress.kubernetes.io/proxy-real-ip-cidr: "0.0.0.0/0"
    nginx.ingress.kubernetes.io/use-forwarded-headers: "true"
    
    # Security headers
    nginx.ingress.kubernetes.io/custom-http-errors: "400,401,403,404,500,502,503,504"
    
    # Timeouts for scraping operations (up to 3 minutes)
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "30"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "180"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "180"
    
    # Body size limit for uploads
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
  
  # Additional configuration snippet for custom headers
  configurationSnippet: |
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

# ArgoCD Configuration
argocd:
  enabled: true  # Set to true to deploy ArgoCD Application resource
  applicationName: pricepointscout-app
  namespace: argocd  # Namespace where ArgoCD is installed
  project: default
  
  source:
    repoURL: https://github.com/OmarZakaria10/PricePointScout-ArgoCD.git
    targetRevision: main
    path: helm/pricepointscout-chart
    helm:
      releaseName: pricepointscout
  
  destination:
    server: https://kubernetes.default.svc
  
  syncPolicy:
    automated:
      prune: false  # Changed to false to prevent wiping resources
      selfHeal: true
      allowEmpty: false
    retry:
      limit: 5
      backoff:
        duration: 5s
        factor: 2
        maxDuration: 3m
